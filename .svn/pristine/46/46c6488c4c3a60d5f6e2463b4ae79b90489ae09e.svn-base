<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/mvc
						http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd
						http://www.springframework.org/schema/beans
						http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
						http://www.springframework.org/schema/context
						http://www.springframework.org/schema/context/spring-context-3.1.xsd
						http://www.springframework.org/schema/util
						http://www.springframework.org/schema/util/spring-util.xsd">

	<bean
		class="com.fcgo.weixin.web.view.bind.ExtRequestMappingHandlerAdapter">
		<property name="webBindingInitializer">
			<bean class="com.fcgo.weixin.web.view.bind.CustomWebBindingInitializer" />
		</property>
		<property name="messageConverters">
			<bean class="org.springframework.http.converter.StringHttpMessageConverter">
				<property name="supportedMediaTypes" value="text/plain;charset=UTF-8" />
			</bean>
		</property>
        <property name="useCacheControlHeader" value="false"/>
        <property name="useExpiresHeader" value="false"/>
        <property name="useCacheControlNoStore" value="false"/>
	</bean>
	<bean id="conversionService"
		class="org.springframework.format.support.FormattingConversionServiceFactoryBean" />
	<mvc:annotation-driven conversion-service="conversionService"/>
	<mvc:resources mapping="/favicon.ico" location="/favicon.ico" />
	<mvc:resources mapping="/robots.txt" location="/robots.txt" />
	<mvc:resources mapping="/monitor.html" location="/monitor.html" />
	<mvc:resources mapping="/resources/**" location="/resources/" />

    <!-- multipart support -->
	<bean name="multipartResolver"
		class="org.springframework.web.multipart.commons.CommonsMultipartResolver" />

	<!-- velocity support -->
	<bean
		class="org.springframework.web.servlet.view.velocity.VelocityConfigurer">
		<property name="resourceLoaderPath" value="/WEB-INF/velocity/" />
		<property name="configLocation"
			value="classpath:/context/velocity/velocity.properties" />
	</bean>
    <util:map id="mediaTypes">
        <entry key="json" value="application/json" />
        <entry key="js" value="text/html" />
        <entry key="jsonp" value="application/javascript"/>
    </util:map>
	<!-- viewResolver velocity layout support -->
	<bean id="viewResolver"
		class="org.springframework.web.servlet.view.ContentNegotiatingViewResolver">
        <property name="ignoreAcceptHeader" value="true"/>
		<property name="defaultContentType" value="text/html" />
		<property name="mediaTypes" ref="mediaTypes"/>
		<property name="viewResolvers">
			<list>
				<bean
					class="com.fcgo.weixin.web.view.velocity.VelocityLayoutViewResolver">
					<property name="contentType" value="text/html;charset=UTF-8" />
					<property name="suffix" value=".vm" />
					<property name="toolboxConfigResource"
						value="classpath:/context/velocity/velocity-tools.xml" />
					<property name="viewClass"
						value="com.fcgo.weixin.web.view.velocity.VelocityLayoutView" />
				</bean>
			</list>
		</property>

		<property name="defaultViews">
            <list>
                <bean class="org.springframework.web.servlet.view.json.MappingJacksonJsonView"/>
                <bean class="com.fcgo.weixin.MappingJacksonJsonpView">
                    <property name="extractValueFromSingleKeyModel" value="true"/>
                        </bean>
                <bean class="org.springframework.web.servlet.view.xml.MarshallingView">
                    <property name="marshaller">
                        <bean class="org.springframework.oxm.xstream.XStreamMarshaller"/>
                    </property>
                </bean>
            </list>
        </property>
	</bean>


</beans>