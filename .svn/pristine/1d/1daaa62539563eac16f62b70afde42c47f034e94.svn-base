package com.fcgo.weixin.controller.shop;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.ResponseBody;

import com.fcgo.weixin.application.product.IProductGroupService;
import com.fcgo.weixin.application.product.IProductService;
import com.fcgo.weixin.application.shop.SellerShopService;
import com.fcgo.weixin.common.dto.BaseSessionUserDTO;
import com.fcgo.weixin.common.dto.Page;
import com.fcgo.weixin.common.util.HttpSessionProvider;
import com.fcgo.weixin.persist.po.ProductGroupPO;
import com.fcgo.weixin.persist.po.ProductPO;
import com.fcgo.weixin.persist.po.SellerShopPO;

@Controller
@RequestMapping(value = "/uc/shop")
public class SellerIndexShopController {
	
	@Autowired
	private SellerShopService shopService;
    @Autowired
    private IProductService productService;
    @Autowired
	private IProductGroupService productGroupService;
    /**
     * @Title: index @Description: 根据参数跳转到店铺首页 @param @param shopId 考虑根据店铺ID 的情况 @param @param sellerId 用户ID @param @return
     *         参数 @return String 返回类型 @throws
     */
    @RequestMapping(value = "/index", method = RequestMethod.GET)
    public String index( HttpServletRequest request, HttpServletResponse response,
            Model model) {
    	BaseSessionUserDTO baseSessionUserDTO =
                (BaseSessionUserDTO) HttpSessionProvider.getAttribute(request, "session_attr_user");
    	List<ProductGroupPO> groupList = productGroupService.findByShopId(baseSessionUserDTO.getShopId());
    	Integer shopId = baseSessionUserDTO.getShopId();
    	SellerShopPO shop= shopService.findById(String.valueOf(shopId));
    	model.addAttribute("groupList", groupList);
    	model.addAttribute("shop", shop);
        return "/shop/shopindex";
    }

    @SuppressWarnings({"unchecked", "rawtypes", "rawtypes"})
    @RequestMapping("/proList")
    public @ResponseBody Map proList(ProductPO product, String pageIndex, HttpServletRequest request, HttpServletResponse response) {
		  Map result = new HashMap();
		  Page page = new Page();
		  if (pageIndex == null || pageIndex == "") {
		  pageIndex = "1";
		  }
		  page.setPageIndex(Integer.valueOf(pageIndex));
		  BaseSessionUserDTO baseSessionUserDTO =
		        (BaseSessionUserDTO) HttpSessionProvider.getAttribute(request, "session_attr_user");
		  product.setShopId(baseSessionUserDTO.getShopId());
		  List<ProductPO> products = productService.findProductList(product, page);
		  if (product == null || products.isEmpty()) {
	            result.put("products", 0);
	      }
	      else {
	            result.put("products", products);
	      }
	      result.put("fcgCategoryId", product.getFcgCategoryId());
	      return result;
    }
}
