<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.fcgo.weixin.persist.dao.IOrderRefundRequestDAO" >
	  <resultMap id="OrdRefundResultMap" type="com.fcgo.weixin.persist.po.OrderRefundRequestPO" >
		 	<id column="ID" property="id" jdbcType="INTEGER" />
		    <result column="IS_DELETE" property="isDelete" jdbcType="INTEGER" />
		    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
		    <result column="REFUND_NUMBER" property="refundNumber" jdbcType="VARCHAR" />
		    <result column="BUYER_ID" property="buyerId" jdbcType="INTEGER" />
		    <result column="SELLER_ID" property="sellerId" jdbcType="INTEGER" />
		    <result column="ORDER_ID" property="orderId" jdbcType="INTEGER" />
		    <result column="ORDER_NUM" property="orderNum" jdbcType="VARCHAR" />
		    <result column="PRODUCT_ID" property="productId" jdbcType="INTEGER" />
		    <result column="PRODUCT_PIC_URL" property="productPicUrl" jdbcType="VARCHAR" />
		    <result column="PRODUCT_NAME" property="productName" jdbcType="VARCHAR" />
		    <result column="PRODUCT_PRICE" property="productPrice" jdbcType="DECIMAL" />
		    <result column="PRODUCT_SPEC" property="productSpec" jdbcType="VARCHAR" />
		    <result column="PRODUCT_QUANT" property="productQuant" jdbcType="INTEGER" />
		    <result column="PRODUCT_TOTAL_AMOUNT" property="productTotalAmount" jdbcType="DECIMAL" />
		    <result column="IS_TUIHUO" property="isTuihuo" jdbcType="INTEGER" />
		    <result column="REFUND_MONEY" property="refundMoney" jdbcType="DECIMAL" />
		    <result column="REFUND_REASON" property="refundReason" jdbcType="VARCHAR" />
		    <result column="REFUSED_REASON" property="refusedReason" jdbcType="VARCHAR" />
		    <result column="REFUND_STATUS" property="refundStatus" jdbcType="VARCHAR" />
		    <result column="AUDIT_NAME" property="auditName" jdbcType="VARCHAR" />
		    <result column="AUDIT_TIME" property="auditTime" jdbcType="TIMESTAMP" />
		    <result column="FINISH_TIME" property="finishTime" jdbcType="TIMESTAMP" />
		    <result column="CREATE_NAME" property="createName" jdbcType="VARCHAR" />
		    <result column="UPDATE_NAME" property="updateName" jdbcType="VARCHAR" />
		    <result column="DELETE_NAME" property="deleteName" jdbcType="VARCHAR" />
		    <result column="DELETE_TIME" property="deleteTime" jdbcType="TIMESTAMP" />
		    <result column="REDUNDS_REASON" property="redundsReason" jdbcType="VARCHAR" />
		    <result column="REFUND_COMMISON" property="refundCommison" jdbcType="DECIMAL" />
		    <result column="fcg_product_price" property="fcgProductPrice" jdbcType="DECIMAL" />
		    <result column="FCG_REFUND_FLAG" property="fcgRefundFlag" jdbcType="INTEGER" />
		    <result column="product_count" property="productCount" jdbcType="INTEGER" />
		    <result column="logistics_company" property="logisticsCompany" jdbcType="VARCHAR" />
		    <result column="logistics_number" property="logisticsNumber" jdbcType="VARCHAR" />
		    <result column="cancel_flag" property="cancelFlag" jdbcType="INTEGER" />
	  </resultMap>
	  <select id="findOrdRefundByPage" parameterType="map" resultMap="OrdRefundResultMap">
	  	select ID, IS_DELETE, CREATE_TIME, UPDATE_TIME as updateTime, REFUND_NUMBER, BUYER_ID, SELLER_ID, ORDER_ID, 
	    ORDER_NUM, PRODUCT_ID, PRODUCT_PIC_URL, PRODUCT_NAME, PRODUCT_PRICE, PRODUCT_SPEC, 
	    PRODUCT_QUANT, PRODUCT_TOTAL_AMOUNT, IS_TUIHUO, REFUND_MONEY, 
	    REFUND_REASON, REFUSED_REASON, REFUND_STATUS, AUDIT_NAME, AUDIT_TIME, FINISH_TIME, 
	    CREATE_NAME, UPDATE_NAME , DELETE_NAME, DELETE_TIME, REDUNDS_REASON, REFUND_COMMISON, 
	    fcg_product_price, FCG_REFUND_FLAG,product_count, logistics_company, logistics_number ,cancel_flag
	    from ord_refund_request where 1=1 and IS_DELETE=0
	   	<!-- 买家 -->
  		<if test="userType=='1'.toString()">
			AND BUYER_ID = #{userId,jdbcType=VARCHAR} 
		</if>
  		 <!-- 卖家 -->
  		<if test="userType=='2'.toString()">
			AND SELLER_ID = #{userId,jdbcType=VARCHAR} 
			
		</if>
		 <!-- 订单状态不为空时添加订单状态条件 -->
		 <if test="refundStatus!=null and refundStatus!=''">
		 		<!-- 售后订单状态 为已拒绝-->
		 		<if test="refundStatus=='2'.toString()">
		 			<!-- 数据库订单状态为 -->
					AND REFUND_STATUS = 4
				</if>
				<!-- 售后订单状态 进行中 -->
		 		<if test="refundStatus=='0'.toString()">
		 			<!-- 数据库订单状态为 -->
					AND (REFUND_STATUS = 1 or REFUND_STATUS = 2)
				</if>
				<!-- 售后订单状态 已完成 -->
		 		<if test="refundStatus=='1'.toString()">
		 			<!-- 数据库订单状态为 -->
					AND REFUND_STATUS = 3
				</if>
		</if>
		 <!-- 排序字段 ,方式（ase desc） -->
		<if test="sorter!=null and sorter!=''">
			 ORDER BY #{sorter}
		</if>
  		  limit #{startPage, jdbcType=DECIMAL},#{endPage, jdbcType=DECIMAL}
	  </select>
	  <select id="getCountBypage" parameterType="map" resultType="int">
	  	select count(0) from ord_refund_request where 1=1 and IS_DELETE=0 
	  	<!-- 买家 -->
  		<if test="userType=='1'.toString()">
			AND BUYER_ID = #{userId,jdbcType=VARCHAR} 
		</if>
  		 <!-- 卖家 -->
  		<if test="userType=='2'.toString()">
			AND SELLER_ID = #{userId,jdbcType=VARCHAR} 
		</if>
		<!-- 订单状态不为空时添加订单状态条件 -->
		  <if test="refundStatus!=null and refundStatus!=''">
		 		<!-- 售后订单状态 为已拒绝-->
		 		<if test="refundStatus=='2'.toString()">
		 			<!-- 数据库订单状态为 -->
					AND REFUND_STATUS = 4
				</if>
				<!-- 售后订单状态 进行中 -->
		 		<if test="refundStatus=='0'.toString()">
		 			<!-- 数据库订单状态为 -->
					AND (REFUND_STATUS = 1 or REFUND_STATUS = 2)
				</if>
				<!-- 售后订单状态 已完成 -->
		 		<if test="refundStatus=='1'.toString()">
		 			<!-- 数据库订单状态为 -->
					AND REFUND_STATUS = 3
				</if>
		</if>
	  </select>
	   <resultMap id="OrderRefundUnionListResultMap" type="com.fcgo.weixin.persist.dto.OrderRefundRequestUnionPO" >
		 	<id column="ID" property="id" jdbcType="INTEGER" />
		    <result column="IS_DELETE" property="isDelete" jdbcType="INTEGER" />
		    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
		    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
		    <result column="REFUND_NUMBER" property="refundNumber" jdbcType="VARCHAR" />
		    <result column="BUYER_ID" property="buyerId" jdbcType="INTEGER" />
		    <result column="BUYER_NAME" property="buyerName" jdbcType="VARCHAR" />
		    <result column="SELLER_ID" property="sellerId" jdbcType="INTEGER" />
		    <result column="BUYER_NAME" property="buyerName" jdbcType="VARCHAR" />
		    <result column="ORDER_ID" property="orderId" jdbcType="INTEGER" />
		    <result column="ORDER_NUM" property="orderNum" jdbcType="VARCHAR" />
		    <result column="PRODUCT_ID" property="productId" jdbcType="INTEGER" />
		    <result column="PRODUCT_PIC_URL" property="productPicUrl" jdbcType="VARCHAR" />
		    <result column="PRODUCT_NAME" property="productName" jdbcType="VARCHAR" />
		    <result column="PRODUCT_PRICE" property="productPrice" jdbcType="DECIMAL" />
		    <result column="PRODUCT_SPEC" property="productSpec" jdbcType="VARCHAR" />
		    <result column="PRODUCT_QUANT" property="productQuant" jdbcType="INTEGER" />
		    <result column="PRODUCT_TOTAL_AMOUNT" property="productTotalAmount" jdbcType="DECIMAL" />
		    <result column="IS_TUIHUO" property="isTuihuo" jdbcType="INTEGER" />
		    <result column="REFUND_MONEY" property="refundMoney" jdbcType="DECIMAL" />
		    <result column="REFUND_REASON" property="refundReason" jdbcType="VARCHAR" />
		    <result column="REFUSED_REASON" property="refusedReason" jdbcType="VARCHAR" />
		    <result column="REFUND_STATUS" property="refundStatus" jdbcType="VARCHAR" />
		    <result column="AUDIT_NAME" property="auditName" jdbcType="VARCHAR" />
		    <result column="AUDIT_TIME" property="auditTime" jdbcType="TIMESTAMP" />
		    <result column="FINISH_TIME" property="finishTime" jdbcType="TIMESTAMP" />
		    <result column="CREATE_NAME" property="createName" jdbcType="VARCHAR" />
		    <result column="UPDATE_NAME" property="updateName" jdbcType="VARCHAR" />
		    <result column="DELETE_NAME" property="deleteName" jdbcType="VARCHAR" />
		    <result column="DELETE_TIME" property="deleteTime" jdbcType="TIMESTAMP" />
		    <result column="REDUNDS_REASON" property="redundsReason" jdbcType="VARCHAR" />
		    <result column="REFUND_COMMISON" property="refundCommison" jdbcType="DECIMAL" />
		    <result column="fcg_product_price" property="fcgProductPrice" jdbcType="DECIMAL" />
		    <result column="FCG_REFUND_FLAG" property="fcgRefundFlag" jdbcType="INTEGER" />
		    <result column="product_count" property="productCount" jdbcType="INTEGER" />
		    <result column="logistics_company" property="logisticsCompany" jdbcType="VARCHAR" />
		    <result column="logistics_number" property="logisticsNumber" jdbcType="VARCHAR" />
	  </resultMap>
	  <select id="findOrdRefundRequestUnionListByPage" parameterType="map" resultMap="OrderRefundUnionListResultMap">
	  	select ID, IS_DELETE, CREATE_TIME, UPDATE_TIME as updateTime, REFUND_NUMBER, BUYER_ID, SELLER_ID, ORDER_ID, 
	    ORDER_NUM, PRODUCT_ID, PRODUCT_PIC_URL, PRODUCT_NAME, PRODUCT_PRICE, PRODUCT_SPEC, 
	    PRODUCT_QUANT, PRODUCT_TOTAL_AMOUNT, IS_TUIHUO, REFUND_MONEY, 
	    REFUND_REASON, REFUSED_REASON, REFUND_STATUS, AUDIT_NAME, AUDIT_TIME, FINISH_TIME, 
	    CREATE_NAME, UPDATE_NAME , DELETE_NAME, DELETE_TIME, REDUNDS_REASON, REFUND_COMMISON, 
	    fcg_product_price, FCG_REFUND_FLAG,product_count, logistics_company, logistics_number,
	    buyer.NIKE_NAME,seller.SELLER_NAME
	    from ord_refund_request  
	    left join user_info buyer on ord_refund_request.BUYER_ID = buyer.id 
	    left join user_info seller on ord_refund_request.SELLER_ID = seller.id 
	     where 1=1 
  		<if test="productName!=null and productName!=''">
			AND (
			    ORDER_NUM like #{productName,jdbcType=VARCHAR} 
			    or  buyer.NIKE_NAME like #{productName,jdbcType=VARCHAR} 
				or  seller.SELLER_NAME like #{productName,jdbcType=VARCHAR} 
				or  product_Name like #{productName,jdbcType=VARCHAR} 
				or  product_Spec like #{productName,jdbcType=VARCHAR} 
				or  refund_reason like #{productName,jdbcType=VARCHAR}
				or  REFUSED_REASON like #{productName,jdbcType=VARCHAR} 
				or  AUDIT_NAME like #{productName,jdbcType=VARCHAR} 
				or  REDUNDS_REASON like #{productName,jdbcType=VARCHAR} 
				or  logistics_company like #{productName,jdbcType=VARCHAR} 
				or  logistics_number like #{productName,jdbcType=VARCHAR} 
			)
		</if>
		 <if test="isTuihuo!=null and isTuihuo!=''">
			AND IS_TUIHUO = #{isTuihuo,jdbcType=VARCHAR} 
		</if>
		<if test="refundStatus!=null and refundStatus!=''">
			 AND REFUND_STATUS like #{refundStatus,jdbcType=VARCHAR} 
		</if>
		<if test="fcgRefundFlag!=null and fcgRefundFlag!=''">
			 AND FCG_REFUND_FLAG like #{fcgRefundFlag,jdbcType=VARCHAR} 
		</if>
			ORDER BY ord_refund_request.CREATE_TIME DESC
  		  limit #{startPage, jdbcType=DECIMAL},#{pageSize, jdbcType=DECIMAL}
	  </select>
	  <select id="getOdrRfdRequestUnionCountByPage" parameterType="map" resultType="int">
	  	select count(1)
	    from ord_refund_request  
	    left join user_info buyer on ord_refund_request.BUYER_ID = buyer.id 
	    left join user_info seller on ord_refund_request.SELLER_ID = seller.id 
	     where 1=1 
  		<if test="productName!=null and productName!=''">
			AND (
			    ORDER_NUM like #{productName,jdbcType=VARCHAR} 
			    or  buyer.NIKE_NAME like #{productName,jdbcType=VARCHAR} 
				or  seller.SELLER_NAME like #{productName,jdbcType=VARCHAR} 
				or  product_Name like #{productName,jdbcType=VARCHAR} 
				or  product_Spec like #{productName,jdbcType=VARCHAR} 
				or  refund_reason like #{productName,jdbcType=VARCHAR}
				or  REFUSED_REASON like #{productName,jdbcType=VARCHAR} 
				or  AUDIT_NAME like #{productName,jdbcType=VARCHAR} 
				or  REDUNDS_REASON like #{productName,jdbcType=VARCHAR} 
				or  logistics_company like #{productName,jdbcType=VARCHAR} 
				or  logistics_number like #{productName,jdbcType=VARCHAR} 
			)
		</if>
		 <if test="isTuihuo!=null and isTuihuo!=''">
			AND IS_TUIHUO = #{isTuihuo,jdbcType=VARCHAR} 
		</if>
		<if test="refundStatus!=null and refundStatus!=''">
			 AND REFUND_STATUS like #{refundStatus,jdbcType=VARCHAR} 
		</if>
		<if test="fcgRefundFlag!=null and fcgRefundFlag!=''">
			 AND FCG_REFUND_FLAG like #{fcgRefundFlag,jdbcType=VARCHAR} 
		</if>
	  </select>
	  
  </mapper>