$(function(){
	var orderState=$(".orderState").val();
	if(orderState==""){
		$(".tapDiv").find(".tap").css("border-bottom","1px solid #EBECEE");
		$("#tap1").css("border-bottom","2px solid #D13600");
	}else{
		$(".tapDiv").find(".tap").each(function(){
			if($(this).attr("mag")==orderState){
				$(".tapDiv").find(".tap").css("border-bottom","1px solid #EBECEE");
				$(this).css("border-bottom","2px solid #D13600");
			}
		})
	}
})

(function($, doc) {
	$.init();
	$.ready(function() {
		
	});
})(mui, document);




//-----------------------------------------------------------------
mui.init({
	pullRefresh: {
		container: '#pullrefresh',
		down: {
			callback: pulldownRefresh
		},
		up: {
			  contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
		      contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
		      callback :pullupRefresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
		}
	}
});
/**
* 下拉刷新具体业务实现
*/
function pulldownRefresh() {
setTimeout(function() {
	mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
}, 500);
}

/**
 * 上拉加载具体业务实现
 */
var pageIndex=1;
function pullupRefresh() {
	setTimeout(function() {
		mui('#pullrefresh').pullRefresh().endPullupToRefresh();
		var table = document.body.querySelector('.mui-table-view');
		var response = getResponseData(pageIndex);
		for(var e in response){
			li = document.createElement('li');
			li.setAttribute("style","padding: 0px;background: #FFFFFF;width:100%;position: relative;");
			li.className = 'mui-table-view-cell';
			var html="<div class='oneOrder' id="+response[e].orderRefundRequestPO.id+">"+
					"<div class='orderInfoDiv'>"+
					"<div class='orderNum'><span>售后单号："+response[e].orderRefundRequestPO.refundNumber+"</span></div>"+
					"<div class='orderTime'><span><fmt:formatDate value='"+response[e].orderRefundRequestPO.createTime+"' pattern='yyyy-MM-dd HH:mm:ss'/></span></div>"+
					"<div class='clear'></div></div>"+
					
					"<div class='oneGoods'>"+
					"<div class='goodsImgDiv'>"+
					"<img src='/resources/images/'"+response[e].orderRefundRequestPO.productPicUrl+" class='goodsImg'/>"+
					"</div>"+
					
					"<div class='goodsInfo'>"+
					"<div class='goodsName'>"+response[e].orderRefundRequestPO.productName+"</div>"+
					"<div class='goodsInfoFloor'>"+
					"<div class='inventory'>"+
					"<span>单价："+response[e].orderRefundRequestPO.productPrice+"</span>";
					if(response[e].orderRefundRequestPO.isTuihuo=="1"){
						html+="<span>退货数量："+response[e].orderRefundRequestPO.productQuant+"</span>";
					}
					html+="<span>规格：¥"+response[e].orderRefundRequestPO.productSpec+"</span>"+
					"</div>"+
					"<div><span>总价：</span><span class='price'>¥"+response[e].orderRefundRequestPO.productTotalAmount+"</span></div>"+
					"</div></div><div class='clear'></div></div>"+
					
					
					"<div class='goodsOperation'>";
					if(response[e].orderRefundRequestPO.refundStatus=="1"){
						html+="<div class='goodsStatus'>申请中</div>";
						if(response[e].productType=="2" && response[e].orderRefundRequestPO.fcgRefundFlag=="0"){
							html+="<button class='goodsBtn'>移交非常购</button>";
						}
						if(response[e].productType=="1"){
							html+="<button class='goodsBtn'>通过</button><button class='goodsBtn'>拒绝</button>";
						}
					}
					
					if(response[e].orderRefundRequestPO.refundStatus=="2"){
						html+="<div class='goodsStatus'>已通过</div>";
					}
					if(response[e].orderRefundRequestPO.refundStatus=="3"){
						html+="<div class='goodsStatus'>已完成</div>";
					}
					if(response[e].orderRefundRequestPO.refundStatus=="4"){
						html+="<div class='goodsStatus'>已拒绝</div>";
					}
					html+="<div class='clear'></div></div></div>"
			
			$("#goodsListInfo").append(html);
			this.endPullupToRefresh(true|false);
		}
	}, 500);
}

//获取实时分页数据
function getResponseData(obj){
	var response=new Array();
	var refundStatus=$(".refundStatus").val();
	//查询被选中的,初次
	if(obj==0){
		pageIndex=1;//初次加载，从第一页开始
	}else{
		pageIndex=obj+1;
	}
	$.ajax({
		type:'post',
		url:'/uc/ordRefundRequest/findOrdRufundBypageAjax?refundStatus='+refundStatus,
		data:{"pageIndex":pageIndex},
		async:false,
		success:function(obj){
			response = obj.rows;
		}
	});
	return response;	
}

//tab选择
function findOrderRefundType(type){
	if(type=='-1'){
		window.location.href="/uc/ordRefundRequest/findOrdRufundBypage?refundStatus="+type;
	}
	if(type=='0'){
		window.location.href="/uc/ordRefundRequest/findOrdRufundBypage?refundStatus="+type;
	}
	if(type=='1'){
		window.location.href="/uc/ordRefundRequest/findOrdRufundBypage?refundStatus="+type;
	}
	if(type=='2'){
		window.location.href="/uc/ordRefundRequest/findOrdRufundBypage?refundStatus="+type;
	}
}

//详细
/*function findDetailById(id){
	window.location.href="/uc/ordRefundRequest/findBydetail?ordRefundId="+id;
}*/

//详细
mui(".mui-table-view").on('tap','.oneOrder',function(){
	  //获取id
	var id = this.getAttribute("id");
	window.location.href="/uc/ordRefundRequest/findBydetail?ordRefundId="+id;
});